var BookieForm=function(e){e.length&&($("[type='submit']",e).click(this.submitClickHandler),$("input[data-verify-url]",e).on("input",this.verifyChangeHandler.bind(this)),e.submit(this.submitHandler))};BookieForm.prototype.submitClickHandler=function(e){var i=$(this),t=i.attr("name"),o=i.attr("value"),r=i.closest("form"),n=$("input[type='hidden'][name='"+t+"']",r);t&&o&&(n.length?n.first().attr("value",o):r.prepend("<input type='hidden' name='"+t+"' value='"+o+"'>"))},BookieForm.prototype.submitHandler=function(e){e.preventDefault();var i=$(this),t=i.attr("action"),o=i.serialize();$.ajax({type:"POST",url:t,data:o,success:function(e){if(!e.success){var i=e.messageType?e.messageType:"error",t=e.message?e.message:"Whoops! Looks like something went wrong.";return void BookieUI.messages.add(i,t)}if(e.hasOwnProperty("message")){var i=e.messageType?e.messageType:"default";return void BookieUI.messages.add(i,e.message)}return e.hasOwnProperty("queue")?void BookieUI.queue.set(e.queue):void 0},xhr:BookieUI.progressBar.getXHR})},BookieForm.prototype.verifyChangeHandler=function(e){var i=e.target,t=this,o=$(i.parentNode);return clearTimeout(i.changeTimeout),o.removeClass("verified error warning"),i.verifying?void t.inputs.stopVerification(i):void(i.changeTimeout=setTimeout(t.inputs.startVerification.bind(t,i),1e3))},BookieForm.prototype.inputs={},BookieForm.prototype.inputs.startVerification=function(e){var i=e.value,t=$(e.parentNode),o=e.getAttribute("data-verify-url"),r=this;t.length&&i&&o&&(e.verifying=!0,e.verifyingID=e.verifyingID+1||1,t.addClass("verifying"),$.ajax({url:o}).done(this.inputs.onVerification.bind(this,e,e.verifyingID)).fail(function(){r.inputs.showWarning(e,"Could not reach validation server"),r.inputs.stopVerification(e)}))},BookieForm.prototype.inputs.stopVerification=function(e){var i=$(e.parentNode);i.length&&(e.verifying=!1,i.removeClass("verifying"))},BookieForm.prototype.inputs.onVerification=function(e,i,t){e.verifyingID===i&&(t.success?t.valid?this.inputs.showVerified(e):this.inputs.showError(e,"Input is invalid"):this.inputs.showWarning(e,"Could not be validated"),this.inputs.stopVerification(e))},BookieForm.prototype.inputs.onVerificationError=function(e){this.inputs.showWarning(e,"Could not reach the validation server")},BookieForm.prototype.inputs.showWarning=function(e,i){console.log("WARNING: ",i," (on ",e,")")},BookieForm.prototype.inputs.showError=function(e,i){var t=$(e.parentNode);t.addClass("error")},BookieForm.prototype.inputs.showVerified=function(e){var i=$(e.parentNode);i.addClass("verified")};
function BookieInventory(t,e){t.length&&(this.options=$.extend({},this.defaults,e),this.$elm=t,this.$items=$(".itembox",t),this.$form=$("form",t),this.$buttons=$(".btn-holder button",this.$form),this.$selectedHolder=$(".item-holder",this.$form),this.$itemHolder=$(".inventory-holder",t),this.selectedItems=[],this.paginated=new BookiePaginated(this.$itemHolder),this.$items.click(this.getItemClickHandler()))}BookieInventory.prototype.defaults={maxItems:10},BookieInventory.prototype.getItemClickHandler=function(){if(this.clickFunction)return this.clickFunction;var t=this;return this.clickFunction=function(){{var e=t.selectedItems.indexOf(this),i=-1!==e;$(this)}i?(t.selectedItems.splice(e,1),$(this).appendTo(t.$itemHolder)):t.selectedItems.length<t.options.maxItems&&(t.selectedItems.push(this),$(this).appendTo(t.$selectedHolder)),t.clickHandler()}},BookieInventory.prototype.clickHandler=function(){this.selectedItems.length?this.$buttons.removeAttr("disabled"):this.$buttons.attr("disabled","true")};
function BookiePaginated(e,i){e.length&&(i=$.extend({},this.defaults,i),this.options=i,this.$elm=e,this.page=0,this.render())}BookiePaginated.prototype.defaults={pageSize:25},BookiePaginated.prototype.createUI=function(){var e=$('<ul class="pagination hidden"><li class="disabled">&lt;</li><div class="pages"></div><li class="disabled">&gt;</li></ul>'),i=this;e.leftArrow=e.children(":first-child"),e.rightArrow=e.children(":last-child"),e.leftArrow.click(function(){return this.classList.contains("disabled")?!0:(i.page=Math.max(i.page-1,0),void i.render())}),e.rightArrow.click(function(){return this.classList.contains("disabled")?!0:(++i.page,void i.render())}),e.insertAfter(this.$elm),this.$ui=e},BookiePaginated.prototype.updateUI=function(e){function i(e){var i=$("<li>"+(e+1)+"</li>");return e===s.page&&i.addClass("active"),i.click(function(){s.setPage(e)}),i}if(this.hasOwnProperty("$ui")||this.createUI(),e.length<=this.options.pageSize)return void this.$ui.addClass("hidden");var t=Math.ceil(e.length/this.options.pageSize)-1,s=this;this.$ui.leftArrow.toggleClass("disabled",0===this.page),this.$ui.rightArrow.toggleClass("disabled",this.page>=t);var r=this.$ui.children(".pages");r.children().remove();var a=[0,this.page-1,this.page,this.page+1,t];a=a.filter(function(e,i,s){return s.indexOf(Math.max(Math.min(e,t),0))===i});for(var o=0;o<a.length;++o){var n=a[o],d=i(n);r.append(d),n>0&&t>n&&(-1===a.indexOf(n-1)&&$('<li class="disabled">...</li>').insertBefore(d),-1===a.indexOf(n+1)&&$('<li class="disabled">...</li>').insertAfter(d))}this.$ui.removeClass("hidden")},BookiePaginated.prototype.setPage=function(e){this.page=Math.max(0,e),this.render()},BookiePaginated.prototype.render=function(){var e=this.$elm.children(),i=e,t=this.options;e.addClass("hidden"),this.filter&&(i=i.filter(this.filter)),this.sorter&&(i=i.sort(this.sorter)),this.sorter&&this.$elm.prepend(i),this.updateUI(i),i=i.slice(t.pageSize*this.page,t.pageSize*(this.page+1)),i.removeClass("hidden")},BookiePaginated.prototype.setSorter=function(e){this.sorter=e,this.render()},BookiePaginated.prototype.removeSorter=function(){delete this.sorter,this.render()},BookiePaginated.prototype.setFilter=function(e){this.filter=e,this.render()},BookiePaginated.prototype.removeFilter=function(){delete this.filter,this.render()};
function init(){BookieUI.reset(),BookieUI.init()}var BookieUI={};BookieUI.reset=function(){this.inited&&(this.trueInited=!0,this.inited=!1,this.header.inited=!1,this.messages.inited=!!$(".message-container").length,this.queue.inited=!!$("#queue").length)},BookieUI.init=function(){if(!this.inited){if(!this.trueInited&&matchMedia("max-width: 465px")){var e=$("html, body");$("#body").smoothState({onStart:{duration:100,render:function(i,t){$(".page",t).addClass("fadeout"),$("#body > .loader").removeClass("hidden"),e.animate({scrollTop:0},100)}},onEnd:{duration:0,render:function(i,t,o){e.css("cursor","auto"),e.find("a").css("cursor","auto"),t.html(o),init()}},development:!0})}$("form").each(function(){new BookieForm($(this))}),$(".inventory").each(function(){new BookieInventory($(this))}),"undefined"!=typeof twttr&&twttr.hasOwnProperty("widgets")&&twttr.widgets.hasOwnProperty("load")&&twttr.widgets.load(),this.progressBar.init(),this.messages.init(),this.queue.init(),this.header.init(),this.inited=!0}},BookieUI.header={},BookieUI.header.inited=!1,BookieUI.header.init=function(){if(!this.inited){this.inited=!0;var e,i,t=this,o=$(".header"),s=$($(".nav .item.active").length?".nav .item.active":".nav .item:first-of-type"),n=$("#nav-indicator");t.fixed=$(window).scrollTop()>e,t.$elm=o,t.$indicator=n,t.$active=s,BookieUI.trueInited||($(window).scroll(function(){var i=$(window).scrollTop();!t.fixed&&i>e?(t.fixed=!0,t.$elm.addClass("fixed")):t.fixed&&e>i&&(t.fixed=!1,t.$elm.removeClass("fixed"))}),$(window).resize(function(){t.fixed||(e=$(".nav").offset().top||$(".mobile-nav").offset().top),t.moveIndicator(t.$active,!0)})),$(window).resize(),$(".nav > .item").hover(function(){clearTimeout(i),t.moveIndicator($(this))},function(){i=setTimeout(function(){t.moveIndicator(t.$active)},500)})}},BookieUI.header.moveIndicator=function(e,i){if(e.length&&(i&&this.$indicator.addClass("no-anim"),this.$indicator.css({left:e.position().left,width:e.width(),backgroundColor:e.css("color")}),i)){var t=this;setTimeout(function(){t.$indicator.removeClass("no-anim")},5)}},BookieUI.queue={},BookieUI.queue.inited=!1,BookieUI.queue.init=function(){this.inited||(this.$elm=$('<div id="queue"></div>').hide().appendTo("body"),this.inited=!0)},BookieUI.queue.set=function(e){this.inited||this.init(),this.$elm.html(e),this.$elm.fadeIn(200)},BookieUI.queue.remove=function(){if(this.inited){var e=this;e.inited=!1,this.$elm.fadeOut(200,function(){e.$elm.remove()})}},BookieUI.messages=[],BookieUI.messages.inited=!1,BookieUI.messages.init=function(){this.inited||(this.$container=$(".popup"),this.inited=!0)},BookieUI.messages.add=function(e,i,t){this.inited||this.init();var o=$('<div class="message '+e+'"></div>').html(i).appendTo(this.$container),s=o[0];return BookieUI.messages.push(s),s._removeable=!0,s._removeFunc=function n(){s._removeable?(clearTimeout(s._removeTimer),o.fadeOut(200,function(){var e=BookieUI.messages.indexOf(s);-1!==e&&BookieUI.messages.splice(e,1),o.remove()})):s._removeTimer=setTimeout(n,250)},o.hover(function(){this._removeable=!1,clearTimeout(this._removeTimer)},function(){this._removeable=!0,void 0!==t&&(s._removeTimer=setTimeout(this._removeFunc,1500))}).click(function(){this._removeable=!0,this._removeFunc()}),void 0!==t&&(s._removeTimer=setTimeout(s._removeFunc,t)),o},BookieUI.messages.addText=function(e,i,t){var o=document.createElement("div");return o.innerHTML=i,this.add(e,o.textContent,t)},BookieUI.progressBar={},BookieUI.progressBar.inited=!1,BookieUI.progressBar.init=function(){this.inited||(this.inited=!0,this.progress=this.targetProgress=0,this.visible=!1,this.$elm=$("#progress-bar"))},BookieUI.progressBar.getXHR=function(){var e=new XMLHttpRequest,i=BookieUI.progressBar;return e.addEventListener("readystatechange",function(){switch(e.readyState){case 1:i.setTarget(10),i.setProgress(1);break;case 2:i.setProgress(2);break;case 3:i.setProgress(5);break;case 4:i.setProgress(10)}}),e},BookieUI.progressBar.setProgress=function(e){this.inited&&(this.progress=Math.max(0,e),this.draw())},BookieUI.progressBar.setTarget=function(e){this.inited&&(this.targetProgress=Math.max(0,e))},BookieUI.progressBar.draw=function(){if(this.inited){if(this.targetProgress){var e=Math.round(this.progress/this.targetProgress*100);this.$elm.show(),this.$elm.width(e+"%")}if(this.progress>=this.targetProgress){this.progress=this.targetProgress=0,this.visible=!1;var i=this;setTimeout(function(){i.$elm.fadeOut(100,function(){i.$elm.width("0")})},100)}else this.visible=!0}},$(init);