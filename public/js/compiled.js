var BookieForm=function(e){e.length&&($("[type='submit']",e).click(this.submitClickHandler),$("input[data-verify-url]",e).on("input",this.verifyChangeHandler.bind(this)),e.submit(this.submitHandler))};BookieForm.prototype.submitClickHandler=function(e){var i=$(this),t=i.attr("name"),o=i.attr("value"),r=i.closest("form"),n=$("input[type='hidden'][name='"+t+"']",r);t&&o&&(n.length?n.first().attr("value",o):r.prepend("<input type='hidden' name='"+t+"' value='"+o+"'>"))},BookieForm.prototype.submitHandler=function(e){e.preventDefault();var i=$(this),t=i.attr("action"),o=i.serialize();$.ajax({type:"POST",url:t,data:o,success:function(e){if(!e.success){var i=e.messageType?e.messageType:"error",t=e.message?e.message:"Whoops! Looks like something went wrong.";return void BookieUI.messages.add(i,t)}if(e.hasOwnProperty("message")){var i=e.messageType?e.messageType:"default";return void BookieUI.messages.add(i,e.message)}return e.hasOwnProperty("queue")?void BookieUI.queue.set(e.queue):void 0},xhr:BookieUI.progressBar.getXHR})},BookieForm.prototype.verifyChangeHandler=function(e){var i=e.target,t=this,o=$(i.parentNode);return clearTimeout(i.changeTimeout),o.removeClass("verified error warning"),i.verifying?void t.inputs.stopVerification(i):void(i.changeTimeout=setTimeout(t.inputs.startVerification.bind(t,i),1e3))},BookieForm.prototype.inputs={},BookieForm.prototype.inputs.startVerification=function(e){var i=e.value,t=$(e.parentNode),o=e.getAttribute("data-verify-url"),r=this;t.length&&i&&o&&(e.verifying=!0,e.verifyingID=e.verifyingID+1||1,t.addClass("verifying"),$.ajax({url:o}).done(this.inputs.onVerification.bind(this,e,e.verifyingID)).fail(function(){r.inputs.showWarning(e,"Could not reach validation server"),r.inputs.stopVerification(e)}))},BookieForm.prototype.inputs.stopVerification=function(e){var i=$(e.parentNode);i.length&&(e.verifying=!1,i.removeClass("verifying"))},BookieForm.prototype.inputs.onVerification=function(e,i,t){if(e.verifyingID===i){var o;try{o=JSON.parse(t)}catch(r){o={success:!1}}o.success?o.valid?this.inputs.showVerified(e):this.inputs.showError(e,"Input is invalid"):this.inputs.showWarning(e,"Could not be validated"),this.inputs.stopVerification(e)}},BookieForm.prototype.inputs.onVerificationError=function(e){this.inputs.showWarning(e,"Could not reach the validation server")},BookieForm.prototype.inputs.showWarning=function(e,i){console.log("WARNING: ",i," (on ",e,")")},BookieForm.prototype.inputs.showError=function(e,i){var t=$(e.parentNode);t.addClass("error")},BookieForm.prototype.inputs.showVerified=function(e){var i=$(e.parentNode);i.addClass("verified")};
function BookieInventory(t,e){t.length&&(this.options=$.extend({},this.defaults,e),this.$elm=t,this.$items=$(".itembox",t),this.$form=$("form",t),this.$buttons=$(".btn-holder button",this.$form),this.$selectedHolder=$(".item-holder",this.$form),this.$itemHolder=$(".inventory-holder",t),this.selectedItems=[],this.$items.click(this.getItemClickHandler()))}BookieInventory.prototype.defaults={maxItems:10},BookieInventory.prototype.getItemClickHandler=function(){if(this.clickFunction)return this.clickFunction;var t=this;return this.clickFunction=function(){{var e=t.selectedItems.indexOf(this),i=-1!==e;$(this)}i?(t.selectedItems.splice(e,1),$(this).appendTo(t.$itemHolder)):t.selectedItems.length<t.options.maxItems&&(t.selectedItems.push(this),$(this).appendTo(t.$selectedHolder)),t.clickHandler()}},BookieInventory.prototype.clickHandler=function(){this.selectedItems.length?this.$buttons.removeAttr("disabled"):this.$buttons.attr("disabled","true")};
function init(){BookieUI.reset(),BookieUI.init()}var BookieUI={};BookieUI.reset=function(){this.inited&&(this.trueInited=!0,this.inited=!1,this.header.inited=!1,this.messages.inited=!!$(".message-container").length,this.queue.inited=!!$("#queue").length)},BookieUI.init=function(){this.inited||(!this.trueInited&&matchMedia("max-width: 465px")&&$("#body").smoothState({callback:init,onStart:{duration:100,render:function(e,i){$(".page",i).addClass("fadeout")}}}),$("form").each(function(){new BookieForm($(this))}),$(".inventory").each(function(){new BookieInventory($(this))}),"undefined"!=typeof twttr&&twttr.widgets.hasOwnProperty("load")&&twttr.widgets.load(),this.progressBar.init(),this.messages.init(),this.queue.init(),this.header.init(),this.inited=!0)},BookieUI.header={},BookieUI.header.inited=!1,BookieUI.header.init=function(){if(!this.inited){this.inited=!0;var e,i,t=this,s=$(".header"),o=$($(".nav .item.active").length?".nav .item.active":".nav .item:first-of-type"),n=$("#nav-indicator");t.fixed=$(window).scrollTop()>e,t.$elm=s,t.$indicator=n,t.$active=o,BookieUI.trueInited||($(window).scroll(function(){var i=$(window).scrollTop();!t.fixed&&i>e?(t.fixed=!0,t.$elm.addClass("fixed")):t.fixed&&e>i&&(t.fixed=!1,t.$elm.removeClass("fixed"))}),$(window).resize(function(){t.fixed||(e=$(".nav").offset().top||$(".mobile-nav").offset().top),t.moveIndicator(t.$active,!0)})),$(window).resize(),$(".nav > .item").hover(function(){clearTimeout(i),t.moveIndicator($(this))},function(){i=setTimeout(function(){t.moveIndicator(t.$active)},500)})}},BookieUI.header.moveIndicator=function(e,i){if(e.length&&(i&&this.$indicator.addClass("no-anim"),this.$indicator.css({left:e.position().left,width:e.width(),backgroundColor:e.css("color")}),i)){var t=this;setTimeout(function(){t.$indicator.removeClass("no-anim")},5)}},BookieUI.queue={},BookieUI.queue.inited=!1,BookieUI.queue.init=function(){this.inited||(this.$elm=$('<div id="queue"></div>').hide().appendTo("body"),this.inited=!0)},BookieUI.queue.set=function(e){this.inited||this.init(),this.$elm.html(e),this.$elm.fadeIn(200)},BookieUI.queue.remove=function(){if(this.inited){var e=this;e.inited=!1,this.$elm.fadeOut(200,function(){e.$elm.remove()})}},BookieUI.messages=[],BookieUI.messages.inited=!1,BookieUI.messages.init=function(){this.inited||(this.$container=$('<div class="message-container"></div>').insertBefore(".page"),this.inited=!0)},BookieUI.messages.add=function(e,i){this.inited||this.init();var t=$('<div class="message message-'+e+'"></div>').text(i).appendTo(this.$container);return BookieUI.messages.push(t[0]),t[0]._removeable=!0,t[0]._removeFunc=function s(){t[0]._removeable?(clearTimeout(t[0]._removeTimer),t.fadeOut(200,function(){var e=BookieUI.messages.indexOf(t[0]);-1!==e&&BookieUI.messages.splice(e,1),t.remove()})):t[0]._removeTimer=setTimeout(s,250)},t[0]._removeTimer=setTimeout(t[0]._removeFunc,3500),t.hover(function(){this._removeable=!1,clearTimeout(this._removeTimer)},function(){this._removeable=!0,t[0]._removeTimer=setTimeout(this._removeFunc,2500)}).click(function(){this._removeable=!0,this._removeFunc()}),t},BookieUI.progressBar={},BookieUI.progressBar.inited=!1,BookieUI.progressBar.init=function(){this.inited||(this.inited=!0,this.progress=this.targetProgress=0,this.visible=!1,this.$elm=$("#progress-bar"))},BookieUI.progressBar.getXHR=function(){var e=new XMLHttpRequest,i=BookieUI.progressBar;return e.addEventListener("readystatechange",function(){switch(e.readyState){case 1:i.setTarget(10),i.setProgress(1);break;case 2:i.setProgress(2);break;case 3:i.setProgress(5);break;case 4:i.setProgress(10)}}),e},BookieUI.progressBar.setProgress=function(e){this.inited&&(this.progress=Math.max(0,e),this.draw())},BookieUI.progressBar.setTarget=function(e){this.inited&&(this.targetProgress=Math.max(0,e))},BookieUI.progressBar.draw=function(){if(this.inited){if(this.targetProgress){var e=Math.round(this.progress/this.targetProgress*100);this.$elm.show(),this.$elm.width(e+"%")}if(this.progress>=this.targetProgress){this.progress=this.targetProgress=0,this.visible=!1;var i=this;setTimeout(function(){i.$elm.fadeOut(100,function(){i.$elm.width("0")})},100)}else this.visible=!0}},$(init);